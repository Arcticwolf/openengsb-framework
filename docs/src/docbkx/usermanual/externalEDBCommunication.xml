<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--

   Copyright 2010 OpenEngSB Division, Vienna University of Technology

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   programlistingUnless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

-->
<chapter id="externalEDBCommunication" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>How to communicate with the Engineering Data Base</title>
  
  <section>
    <title id="general">General</title>

    <para>To communicate with the EDB instances in the OpenEngSB, it is required to send
      JMS messages to the queue "org.openengsb.edb", while the message type defines 
      the actual operation. Schemas and/or samples of the messages can be found in the  
      following sections. For the reply, a destination has to be defined and added to 
      the message as reply queue.</para>

  </section>
  
  <section>
    <title id="contentStorage">Content Storage</title>

    <para>The EDB endpoint can receive messages to store and query content
      (as well as undoing the last changes). (TODO: add operation element)
      The schema for storing content goes as follows:</para>    

    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/acm-persist.xsd" /></textobject>
    </programlisting>
    <para>NOTE: the field "path" defines the abstract path names of the hierachical structure of the content, where the fieldnames with the elements from "path" describe the actual path, i.e. path = "/a/b/c" is abstract and the actual path is a="any", b="real", c="pathName".</para> 
    <para>Queries are structured as [keyname]:[valuename](AND [keyname]:[valuename])*, whereas [keyname] can be every possible fieldname of the stored content. The entire schema goes as follows</para>

    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/acm-query-request.xsd" /></textobject>
    </programlisting> 
    
    <para>The reply for both messages (successfully persisted or found) contains a list of object, much like as in the persist-message:</para>

    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/acm-response.xsd" /></textobject>
    </programlisting> 

    
    <para>TODO: describe reset message</para>
    <programlisting>
      <![CDATA[TODO:reset schema]]>
    </programlisting>

  </section>

  <section>
    <title id="linking">Linking</title>

    <para>The messages described in this section are used to register and query for links.</para>
    <para>The RegisterLinkMessage is used to create a new link which consists of a "source" element (usually the uuid of another element stored in the EDB should be used here), a "type" referencing any tool this link should be applied too and a "param", encapsulating the command that should be send to the targetted application. Below is a sample of such a message</para>
    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/LinkRegisterMessage.xml" /></textobject>
    </programlisting>
    
    <para>A reponse (upon succuessfull registration) will receive a list of registered links plus their UUIDs.</para>
    
    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/LinkRegisteredMessage.xml" /></textobject>
    </programlisting>
    
    <para>The LinkQuerMessage is used to retrieve all links matching the given search criteria. The usual single criterion should be the "source" field, although it is possible to search for type and/or param as well.</para>

    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/LinkQueryRequestMessage.xml" /></textobject>
    </programlisting>

    <para>A reponse (upon succuessfull query) will receive a list of registered links matching the search criteria.</para>
    
    <programlisting language="xml">
      <textobject><textdata fileref="../../openengsb-docs/src/docbkx/usermanual/edb/LinkQueryRequestedMessage.xml" /></textobject>
    </programlisting>

  </section>

</chapter>
