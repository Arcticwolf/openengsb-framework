<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--

   Copyright 2010 OpenEngSB Division, Vienna University of Technology

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

-->
<chapter id="svnConnector" xmlns="http://docbook.org/ns/docbook">
  <title id="svnConnector.title">SVN Connector</title>

  <para>
    This connector is an SVN specific implementation of the SCM connector and is used to poll SVN servers and send events to drools if any updates occur.
  </para>
  
  <para>
    The poller will use the update-method periodically to get a list with all created, deleted branches, tags and commits.
    It will send an appropriate event to drools for each affected directory
  </para>
  
  <section>
    <title>Configuration</title>
    
    <para>
      All configurations can be set in the xbean.xml of the SU. Every project that you want to poll needs a seperate SU and configuration.
    </para>
    
    <section>
      <title>Connection</title>
      
      <programlisting><![CDATA[  <bean id="connector" class="org.openengsb.svn.SvnConnector" init-method="init">
    <property name="workingCopy" value="NAME" />
    <property name="developerConnection" value="CONNECTIONURL" />
    <property name="username" value="USERNAME" />
    <property name="password" value="PASSWORD" />
  </bean>]]></programlisting>

      <itemizedlist>
        <listitem>NAME ... unique name for your working copy (svn will checkout the project on Servicemixpath/data/openengsb/NAME)</listitem>
        <listitem>CONNECTIONURL ... connection url to your SVN Server e.g.: "https://localhost/svn/test"</listitem>
        <listitem>USERNAME ... username with access to your svn repository</listitem>
        <listitem>PASSWORD ... password for user</listitem>
      </itemizedlist>
    </section>
  
    <section>
      <title>Poller</title>
      
      <programlisting><![CDATA[  <bean id="simpleTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
    <!-- see the example of method invoking job above -->
    <property name="jobDetail" ref="jobDetail" />
    <property name="startDelay" value="1000" />
    <property name="repeatInterval" value="REPEATINTERVAL" />
  </bean>]]></programlisting>
  
      <itemizedlist>
        <listitem>REPEATINTERVAL ... polling intervall in miliseconds e.g.: 30000 = polling every 30 seconds</listitem>
      </itemizedlist>
    </section>
  </section>
  
  <section>
    <title>Datatypes</title>
    
    <para>
      The update-method will return an UpdateResult object which contains lists of all added, deleted Branches, Tags and Commits
    </para>
    
    <programlisting><![CDATA[public class UpdateResult {
    private List<String> addedBranches = new ArrayList<String>();
    private List<String> addedTags = new ArrayList<String>();
    private List<String> deletedBranches = new ArrayList<String>();
    private List<String> deletedTags = new ArrayList<String>();
    private List<String> committed = new ArrayList<String>();
}]]></programlisting>

  </section>
  
  <section>
    <title>Events</title>
    
    <section>
      <title>ScmDirectoryEvent</title>
      
      <para>
        Super-Event for all SCM events. Will create a SCM domain event and contains setter/getter for the directory property.
      </para>
    </section>
    
    <section>
      <title>ScmBranchCreatedEvent</title>
      
      <para>
        Will be triggered whenever the poller finds a new branch on the SCM server.
        Contains the full-path of the new branch.
      </para>
    </section>
    
    <section>
      <title>ScmBranchDeletedEvent</title>
      
      <para>
        Will be triggerd whenever the poller finds a deleted branch on the SCM server.
        Contains the full-path of the deleted branch.
      </para>
    </section>
    
    <section>
      <title>ScmTagCreatedEvent</title>
      
      <para>
        Will be triggerd whenever the poller finds a new tag on the SCM server.
        Contains the full-path of the new tag.
      </para>
    </section>
    
    <section>
      <title>ScmTagDeletedEvent</title>
      
      <para>
        Will be triggerd whenever the poller finds a deleted tag on the SCM server.
        Contains the full-path of the deleted tag. 
      </para>
    </section>
  </section>
</chapter>
